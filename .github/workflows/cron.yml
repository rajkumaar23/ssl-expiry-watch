name: Run SSL Expiry Watch

on:
  schedule:
    - cron: "23 4 * * *"
  workflow_dispatch:

jobs:
  cron:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: "1.20"

      - name: Run Go build
        run: go build -o ssl-expiry-watcher

      - name: Run the executable
        env:
          HOSTNAMES: "${{ secrets.HOSTNAMES }}"
          THRESHOLD: "${{ secrets.THRESHOLD }}"
          TELEGRAM_ID: "${{ secrets.TELEGRAM_ID }}"
          TELEGRAM_BOT_TOKEN: "${{ secrets.TELEGRAM_BOT_TOKEN }}"
        run: |
          ./ssl-expiry-watcher
